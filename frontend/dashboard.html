<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <!-- Enlace al archivo CSS -->
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
  <body>
    <!-- Contenedor principal -->
    <div class="dashboard-container">
      <button id="protectedBtn">Acceder a recurso protegido</button>
      <button id="logoutBtn">Cerrar sesión</button>
      <button id="replaceTokenBtn">Reemplazar Token</button>
    </div>

    <script>
      // Modificación en el login para evitar que haga la solicitud automáticamente
      window.onload = function () {
        // Solo redirige al login si no hay token en la cookie
        const token = getCookie("access_token");
        if (!token) {
          window.location.href = "/"; // Redirigir al login si no está autenticado
        }
      };

      // Cerrar sesión
      document
        .getElementById("logoutBtn")
        .addEventListener("click", async function () {
          try {
            await fetch("/logout", {
              method: "POST",
              credentials: "include", // Enviar la cookie para que el backend la elimine
            });

            window.location.href = "/"; // Redirigir al login
          } catch (err) {
            console.error("Error al cerrar sesión:", err);
          }
        });

      // Acceder a la ruta /protected
      document
        .getElementById("protectedBtn")
        .addEventListener("click", async function () {
          const response = await fetch("/protected", {
            method: "GET",
            credentials: "include", // 🔹 IMPORTANTE: Enviar la cookie automáticamente
          });

          if (response.ok) {
            window.location.href = "/protegido";
          } else {
            const error = await response.json();
            alert(`Error: ${error.detail}`);
          }
        });
    </script>
  </body>
</html>
